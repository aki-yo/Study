
```
public class LoginUser implements UserDetails {
    private User user;
    private Set<String> permissions;
    
    @Override
    public Collection<? extends GrantedAuthority> getAuthorities() {
        return permissions.stream()
            .map(SimpleGrantedAuthority::new)
            .collect(Collectors.toList());
    }
    
    // å®ç°å…¶ä»–UserDetailsæ–¹æ³•...
}

permissions.stream()
            .map(SimpleGrantedAuthority::new)
            .collect(Collectors.toList());
è¯¦è§£è¿™ä¸ªéƒ¨åˆ†ä»£ç ï¼Œçœ‹ä¸æ‡‚è¿™ä¸ªé“¾å¼è°ƒç”¨
```

è¿™æ®µä»£ç æ˜¯ **Java Stream API** çš„é“¾å¼è°ƒç”¨ï¼Œç”¨äºå°† `Set<String> permissions` é›†åˆä¸­çš„æ¯ä¸ªæƒé™å­—ç¬¦ä¸²è½¬æ¢ä¸º Spring Security çš„ `GrantedAuthority` å¯¹è±¡ï¼ˆè¿™é‡Œç”¨çš„æ˜¯ `SimpleGrantedAuthority`ï¼‰ï¼Œå¹¶æœ€ç»ˆæ”¶é›†æˆä¸€ä¸ª `List`ã€‚  

æˆ‘ä»¬æ¥ä¸€æ­¥æ­¥æ‹†è§£è¿™ä¸ªé“¾å¼è°ƒç”¨ï¼š

---

### **1. `permissions.stream()`**
- `permissions` æ˜¯ä¸€ä¸ª `Set<String>`ï¼Œå­˜å‚¨ç”¨æˆ·çš„æƒé™å­—ç¬¦ä¸²ï¼ˆå¦‚ `"user:add"`, `"user:delete"`ï¼‰ã€‚
- `.stream()` å°† `Set` è½¬æ¢æˆ **Streamï¼ˆæµï¼‰**ï¼Œä»¥ä¾¿è¿›è¡Œåç»­çš„æµå¼æ“ä½œï¼ˆå¦‚ `map`ã€`filter`ã€`collect`ï¼‰ã€‚

---

### **2. `.map(SimpleGrantedAuthority::new)`**
- `.map()` æ˜¯æµçš„ä¸­é—´æ“ä½œï¼Œç”¨äºå¯¹æµä¸­çš„æ¯ä¸ªå…ƒç´ è¿›è¡Œè½¬æ¢ã€‚
- `SimpleGrantedAuthority::new` æ˜¯ä¸€ä¸ª **æ–¹æ³•å¼•ç”¨ï¼ˆMethod Referenceï¼‰**ï¼Œç›¸å½“äºï¼š
  ```java
  .map(permission -> new SimpleGrantedAuthority(permission))
  ```
- ä½œç”¨ï¼šå°†æ¯ä¸ªæƒé™å­—ç¬¦ä¸²ï¼ˆå¦‚ `"user:add"`ï¼‰è½¬æ¢æˆ `SimpleGrantedAuthority` å¯¹è±¡ï¼ˆSpring Security è¦æ±‚çš„æƒé™è¡¨ç¤ºå½¢å¼ï¼‰ã€‚

---

### **3. `.collect(Collectors.toList())`**
- `.collect()` æ˜¯æµçš„ç»ˆæ­¢æ“ä½œï¼Œç”¨äºå°†æµä¸­çš„å…ƒç´ æ”¶é›†åˆ°æŸä¸ªå®¹å™¨ä¸­ã€‚
- `Collectors.toList()` è¡¨ç¤ºå°†æµä¸­çš„ `SimpleGrantedAuthority` å¯¹è±¡æ”¶é›†åˆ°ä¸€ä¸ª `List` ä¸­ã€‚
- æœ€ç»ˆè¿”å›çš„ç±»å‹æ˜¯ `List<SimpleGrantedAuthority>`ã€‚

---

### **å®Œæ•´æµç¨‹å›¾ç¤º**
```
Set<String> permissions = ["user:add", "user:delete"]
   â†“ .stream() 
Stream<String> â†’ "user:add", "user:delete"
   â†“ .map(SimpleGrantedAuthority::new) 
Stream<SimpleGrantedAuthority> â†’ new SimpleGrantedAuthority("user:add"), new SimpleGrantedAuthority("user:delete")
   â†“ .collect(Collectors.toList()) 
List<SimpleGrantedAuthority> â†’ [SimpleGrantedAuthority("user:add"), SimpleGrantedAuthority("user:delete")]
```

---

### **å…³é”®ç‚¹æ€»ç»“**
1. **Stream API**ï¼šæä¾›é“¾å¼æ“ä½œï¼ˆ`stream()` â†’ `map()` â†’ `collect()`ï¼‰ï¼Œè®©é›†åˆå¤„ç†æ›´ç®€æ´ã€‚
2. **æ–¹æ³•å¼•ç”¨**ï¼š`SimpleGrantedAuthority::new` æ˜¯æ„é€ å‡½æ•°å¼•ç”¨ï¼Œç­‰ä»·äº `permission -> new SimpleGrantedAuthority(permission)`ã€‚
3. **Spring Security æƒé™**ï¼š`GrantedAuthority` æ˜¯ Spring Security çš„æ ¸å¿ƒæ¥å£ï¼Œ`SimpleGrantedAuthority` æ˜¯å…¶ç®€å•å®ç°ç±»ï¼Œç”¨äºè¡¨ç¤ºæƒé™å­—ç¬¦ä¸²ã€‚

---

### **æ‰©å±•ï¼šå¦‚æœæƒé™éœ€è¦åŠ å‰ç¼€ï¼ˆå¦‚ `ROLE_`ï¼‰**
å¦‚æœæƒé™éœ€è¦éµå¾ª Spring Security çš„è§’è‰²å‘½åè§„èŒƒï¼ˆå¦‚ `ROLE_ADMIN`ï¼‰ï¼Œå¯ä»¥ä¿®æ”¹ä¸ºï¼š
```java
return permissions.stream()
    .map(permission -> new SimpleGrantedAuthority("ROLE_" + permission)) // æ·»åŠ å‰ç¼€
    .collect(Collectors.toList());
```

---

### **æœ€ç»ˆä½œç”¨**
è¿™æ®µä»£ç çš„ç›®çš„æ˜¯å°†ç”¨æˆ·çš„è‡ªå®šä¹‰æƒé™å­—ç¬¦ä¸²é›†åˆï¼ˆ`Set<String>`ï¼‰è½¬æ¢ä¸º Spring Security éœ€è¦çš„æƒé™å¯¹è±¡é›†åˆï¼ˆ`List<GrantedAuthority>`ï¼‰ï¼Œä»¥ä¾¿åœ¨æƒé™æ ¡éªŒæ—¶ä½¿ç”¨ï¼ˆå¦‚ `@PreAuthorize("hasAuthority('user:add')")`ï¼‰ã€‚




## é“¾å¼ç¼–ç¨‹

boolean ishavezywyh = userRoleList.stream()
    .filter(item -> item.getRoleId().equals(zywyhRole.get(0).getRoleId()))
    .findAny()
    .isPresent();

è¿™æ®µä»£ç çš„ä½œç”¨æ˜¯åˆ¤æ–­å½“å‰ç”¨æˆ·æ˜¯å¦ç»‘å®šäº†æŸä¸ªç‰¹å®šè§’è‰²ï¼ˆè¿™é‡Œæ˜¯â€œä¸“ä¸šå§”å‘˜ä¼šä¸»å¸­â€è§’è‰²ï¼‰ï¼Œå…¶æ ¸å¿ƒé€»è¾‘æ˜¯é€šè¿‡ Java Stream API æ¥è¿›è¡ŒåŒ¹é…æ£€æŸ¥ã€‚

---

### ğŸ“Œ åŸå§‹ä»£ç 
```java
boolean ishavezywyh = userRoleList.stream()
    .filter(item -> item.getRoleId().equals(zywyhRole.get(0).getRoleId()))
    .findAny()
    .isPresent();
```


---

### ğŸ” åˆ†æ­¥è§£æ

#### 1. `userRoleList.stream()`
- å°†ç”¨æˆ·ç»‘å®šçš„æ‰€æœ‰è§’è‰²åˆ—è¡¨ `userRoleList` è½¬æ¢æˆä¸€ä¸ª **Stream**ï¼Œä»¥ä¾¿ä½¿ç”¨æµå¼æ“ä½œè¿›è¡Œè¿‡æ»¤å’ŒæŸ¥æ‰¾ã€‚

#### 2. `.filter(item -> item.getRoleId().equals(zywyhRole.get(0).getRoleId()))`
- å¯¹æµä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ ï¼ˆå³æ¯ä¸ªç”¨æˆ·ç»‘å®šçš„è§’è‰²ï¼‰è¿›è¡Œè¿‡æ»¤ï¼›
- åˆ¤æ–­å½“å‰è§’è‰²çš„ `roleId` æ˜¯å¦ç­‰äº â€œä¸“ä¸šå§”å‘˜ä¼šä¸»å¸­â€ è§’è‰²çš„ `roleId`ï¼›
- `zywyhRole.get(0).getRoleId()`ï¼šä»æŸ¥è¯¢ç»“æœä¸­å–ç¬¬ä¸€ä¸ªè§’è‰²çš„ IDï¼ˆå‡è®¾åªæŸ¥åˆ°äº†ä¸€æ¡è®°å½•ï¼‰ã€‚

#### 3. `.findAny()`
- åœ¨æ»¡è¶³æ¡ä»¶çš„å…ƒç´ ä¸­ä»»æ„è¿”å›ä¸€ä¸ªåŒ¹é…é¡¹ï¼›
- å¦‚æœæ²¡æœ‰æ‰¾åˆ°åŒ¹é…é¡¹ï¼Œåˆ™è¿”å›ä¸€ä¸ªç©ºçš„ `Optional`ã€‚

#### 4. `.isPresent()`
- æ£€æŸ¥æ˜¯å¦æœ‰åŒ¹é…çš„å…ƒç´ å­˜åœ¨ï¼›
- å¦‚æœæœ‰åŒ¹é…é¡¹ï¼Œè¿”å› `true`ï¼›å¦åˆ™è¿”å› `false`ã€‚

---

### âœ… æœ€ç»ˆä½œç”¨
è¿™è¡Œä»£ç çš„æ„æ€æ˜¯ï¼š

> **åœ¨å½“å‰ç”¨æˆ·çš„ç»‘å®šè§’è‰²ä¸­ï¼Œæ˜¯å¦å­˜åœ¨â€œä¸“ä¸šå§”å‘˜ä¼šä¸»å¸­â€è¿™ä¸ªè§’è‰²ï¼Ÿ**

å¦‚æœå­˜åœ¨ï¼Œ`ishavezywyh` çš„å€¼ä¸º `true`ï¼Œè¡¨ç¤ºè¯¥ç”¨æˆ·æ‹¥æœ‰æ­¤è§’è‰²ã€‚

---

### ğŸ’¡ ç¤ºä¾‹è¯´æ˜

å‡è®¾ï¼š
- `userRoleList` ä¸­åŒ…å«ä»¥ä¸‹è§’è‰² IDï¼š`[100, 200, 300]`
- `zywyhRole.get(0).getRoleId()` è¿”å›çš„æ˜¯ `200`

åˆ™ï¼š
```java
ishavezywyh == true
```


å› ä¸º `200` å­˜åœ¨äºç”¨æˆ·ç»‘å®šçš„è§’è‰²åˆ—è¡¨ä¸­ã€‚

---

### âš ï¸ æ³¨æ„äº‹é¡¹

1. **`zywyhRole.get(0)` å¯èƒ½ä¼šæŠ›å‡ºå¼‚å¸¸**
   - å¦‚æœ `zywyhRole` æ˜¯ç©ºåˆ—è¡¨ï¼ˆå³æ²¡æœ‰æŸ¥åˆ°å¯¹åº”è§’è‰²ï¼‰ï¼Œè°ƒç”¨ `.get(0)` ä¼šæŠ›å‡º `IndexOutOfBoundsException`ã€‚
   - âœ… **å»ºè®®ä¼˜åŒ–**ï¼š
     ```java
     if (!zywyhRole.isEmpty()) {
         boolean ishavezywyh = userRoleList.stream()
             .anyMatch(item -> item.getRoleId().equals(zywyhRole.get(0).getRoleId()));
     }
     ```


2. **æ¨èä½¿ç”¨ `anyMatch` ç®€åŒ–å†™æ³•**
   ```java
   boolean ishavezywyh = userRoleList.stream()
       .anyMatch(item -> item.getRoleId().equals(zywyhRole.get(0).getRoleId()));
   ```

   æ›´ç®€æ´ã€è¯­ä¹‰æ›´æ¸…æ™°ã€‚

---

### âœ… æ€»ç»“

| è¡¨è¾¾å¼ | å«ä¹‰ |
|--------|------|
| `userRoleList.stream()` | å¼€å¯æµå¤„ç† |
| [filter(...)](file://cn\hutool\core\collection\CollUtil.java#L107-L107) | è¿‡æ»¤å‡º roleId åŒ¹é…çš„è§’è‰² |
| `findAny().isPresent()` | æ˜¯å¦å­˜åœ¨è‡³å°‘ä¸€ä¸ªåŒ¹é…é¡¹ |

æœ€ç»ˆç»“æœï¼š
- `true`ï¼šç”¨æˆ·ç»‘å®šäº†â€œä¸“ä¸šå§”å‘˜ä¼šä¸»å¸­â€è§’è‰²ï¼›
- `false`ï¼šæœªç»‘å®šã€‚

