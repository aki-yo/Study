
# @Target(ElementType.METHOD)
@Retention(RetentionPolicy.RUNTIME)
public @interface DataScope {
    String deptAlias() default "";  // 部门表别名
    String userAlias() default "";  // 用户表别名
}这部分中的

@Target(ElementType.METHOD)
@Retention(RetentionPolicy.RUNTIME)是干什么的


这两个是 Java 中的**元注解**（用于修饰其他注解的注解），它们定义了 `@DataScope` 注解的基本行为：

---

### 1. `@Target(ElementType.METHOD)`
**作用**：指定该注解可以应用在哪些Java元素上。

- `ElementType.METHOD` 表示这个注解只能用在**方法**上
- 其他常用选项：
  - `TYPE`（类/接口/枚举）
  - `FIELD`（字段）
  - `PARAMETER`（方法参数）
  - `ANNOTATION_TYPE`（其他注解）

**如果不指定**：注解将无法被使用（编译错误）。

---

### 2. `@Retention(RetentionPolicy.RUNTIME)`
**作用**：指定注解的生命周期（何时有效）。

- `RetentionPolicy.RUNTIME` 表示注解在**运行时**仍保留，可以通过反射读取
- 其他选项：
  - `SOURCE`：仅存在于源码（编译后丢弃，如 `@Override`）
  - `CLASS`：保留到字节码（但运行时不可见）

**为什么需要RUNTIME**：  
因为Spring AOP需要在运行时通过反射检测方法上的 `@DataScope` 注解，如果设为`SOURCE`或`CLASS`，切面将无法获取注解信息。

---

### 完整作用解析
```java
@Target(ElementType.METHOD)          // ↓ 这个注解只能标注在方法上
@Retention(RetentionPolicy.RUNTIME)  // ↓ 且运行时必须保留
public @interface DataScope {        // ↓ 这样Spring AOP才能在运行时通过反射发现它
    String deptAlias() default "";
    String userAlias() default "";
}
```

---

### 类比理解
| 元注解组合 | 效果类比 |
|------------|----------|
| `@Target(ElementType.METHOD)` + `@Retention(RUNTIME)` | 相当于创建一个"方法标签"，这个标签在程序运行时仍然存在，可以被AOP/反射检测到 |
| `@Target(ElementType.FIELD)` + `@Retention(SOURCE)` | 相当于创建一个"字段便签"，只在源码中可见（如Lombok的`@Getter`） |

---

### 实际应用场景
当你在方法上使用 `@DataScope` 时：
```java
@Service
public class UserService {
    
    @DataScope(deptAlias = "d", userAlias = "u")  // ← 这里能使用正是因为@Target允许METHOD
    public List<User> getUserList() {
        //...
    }
}
```

Spring AOP 在运行时通过反射检查方法时：
```java
Method method = userService.getClass().getMethod("getUserList");
DataScope anno = method.getAnnotation(DataScope.class);  // ← 能获取到正是因为@Retention是RUNTIME
```


# 注解使用

```
@Target({ElementType.METHOD, ElementType.TYPE})
@Retention(RetentionPolicy.RUNTIME)
public @interface DataSource {
    DataSourceType value() default DataSourceType.MASTER;
}
```


```
@DataSource(DataSourceType.SLAVE)
public User getUserById(Long id) {
    return userMapper.selectById(id);
}
```

# documented

![](assets/Pasted%20image%2020250704141733.png)