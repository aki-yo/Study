

# 1 外包延时月度出勤明细

前后端分离项目

## 需求
延时月度出勤明细增加外包界面
![](assets/Pasted%20image%2020250722184858.png)

## 开发过程

了解原有业务流程，知道请求路径，方法执行返回过程。

### 后端

#### controller
模仿原有代码增加函数
mapping("/...")
获得loginuser\user
校验主职
设置orghid
开始调用service层获取结果返回
```
return overTimeWorkService.overTimeOutsourceWorkDetails(requestInfo);
```
#### service
模仿原有代码
startpage
```
List<OverTimeWorkDetailsVo> list = hcmOverTimeWorkMapper.queryOutsourceAvgOverTimeWorkDetails(requestInfo);
```
调用mapper层方法
#### mapper:
TB_TMG_EMPOVERTIMEDETAIL
TB_STA_EMP_ORG
TB_STA_EMP_CLASS  限定外包（8）



![](assets/Pasted%20image%2020250722185055.png)


### 前端

![](assets/Pasted%20image%2020250722185939.png)
在小主页vue中添加这个组件

![](assets/Pasted%20image%2020250722185950.png)
然后模仿原有代码写出vue
然后还有js请求设置
![](assets/Pasted%20image%2020250722190032.png)




![](assets/QQ_1753181394597.png)


![](assets/QQ_1753181406632.png)

## 注意
记得还有说明信息之类的修改，例如本次中的 搜索限定范围，外加国际化

因为只有了外包，所以有些条件搜索可以省略，后端代码也可以进行相应的省略

有些地方有拼接sql

菜单是动态分配的（通过 getRoutersByMenuIdAndOrghid，发现登录人的角色id 进而设置）
要到hr系统登录后台账号进入进行相应的增添菜单和设置菜单权限

注意不要提交merge
commit之前要先Pull
如果已经commit，可以soft reset

## 关键表
TB_TMG_EMPOVERTIMEDETAIL
TB_STA_EMP_ORG
TB_STA_EMP_CLASS


# 2 职员、非制造O编制增加15薪字段


## ext

![](assets/Pasted%20image%2020250722191022.png)

这个整体过程就是各种组织层级下的UNIT ALL
然后java层面进行filter groupingby

在数据字典中添加字段
改ext sql 
如果有o15字段，直接用来判断
如果没有则根据需求来

职级需要联表job_class

定时任务测试
继承类，添加配置信息

## 后端

在entity中增加数据库新增字段的相应成员变量
直接改sql增加select 列名

## 前端

增加列

## 注意

有的信息是主键需要连表
增加默认值
记得全方面测试（定时任务测试


中心
	分体系
		部门
		组
	体系
		分体系
			部门
			组
		部门
		组



## 表
异动
TB_STA_INTRANSFERINFO
TB_STA_EMP_TURNOVER

预入职
TB_STA_PREPARE_HIRE
TB_ORG_JOB_CLASS
TB_STA_EMP_ORG

在职
TB_STA_EMP


有 在职 异动 预入职 职员 非制造o 判断方式

[sql解析](../sql解析.md)
2

# 3 esb接口 编制数据返回

和正常 ssm架构一样
对方发送post请求
controller接收
解析参数
ssm查询
封装数据返回

## 注意
记得postmaping即便能自动匹配也要写路径

需要myesb进行配置

测试时需要登录找登陆人code登录得到token

这是内部服务来用的大概，就返回了元数据，没有像给前端那样用什么 firstname secondname之类的来方便前端用

很重要 常数代码要用编码而不是值
```
GETCODENAME(OU.C_LEVEL,'ORGANIZATION_LEVEL') orgLevelName,
```

同一组织不同维度下有不同的隶属关系

