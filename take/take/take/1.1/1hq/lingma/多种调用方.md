åœ¨å…¸å‹çš„ Spring Boot é¡¹ç›®ä¸­ï¼Œ**æœåŠ¡å±‚**ï¼ˆ`EsbCommonService`ï¼‰æ˜¯ç”±**ä¸Šå±‚è°ƒç”¨è€…**è°ƒç”¨çš„ï¼Œè¿™äº›è°ƒç”¨è€…å¯ä»¥æ˜¯ï¼š

---

## âœ… 1. **Controller å±‚ï¼ˆæ§åˆ¶å™¨ï¼‰**

è¿™æ˜¯æœ€å¸¸è§çš„æœåŠ¡å±‚è°ƒç”¨æ¥æºã€‚

### ç¤ºä¾‹ï¼š
```java
@RestController
@RequestMapping("/api/esb")
public class EsbController {

    @Autowired
    private EsbCommonService esbCommonService;

    @PostMapping("/pushCandidate")
    public ResponseResult<String> pushCandidate(@RequestBody CandidatePushDTO dto) {
        String result = esbCommonService.esbSendInfo(EsbPushServiceEnum.REST_OA_CREATEWORKFLOW, dto);
        return ResponseResult.success(result);
    }
}
```


### ğŸ” è¯´æ˜ï¼š
- `@RestController`ï¼šè¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ª REST API æ§åˆ¶å™¨
- `@RequestMapping`ï¼šå®šä¹‰ API è·¯ç”±
- `@PostMapping`ï¼šå®šä¹‰ POST è¯·æ±‚å…¥å£
- `@RequestBody`ï¼šæ¥æ”¶ JSON æ ¼å¼çš„è¯·æ±‚ä½“
- `ResponseResult`ï¼šç»Ÿä¸€è¿”å›æ ¼å¼

### ğŸ“Œ è°ƒç”¨é“¾è·¯ï¼š
```
HTTP è¯·æ±‚ â†’ Controller æ¥æ”¶è¯·æ±‚ â†’ è°ƒç”¨ Service å±‚ â†’ å‘èµ· ESB è°ƒç”¨
```


---

## âœ… 2. **å®šæ—¶ä»»åŠ¡ï¼ˆScheduled Taskï¼‰**

å¦‚æœ ESB æ¨é€æ˜¯å‘¨æœŸæ€§ä»»åŠ¡çš„ä¸€éƒ¨åˆ†ï¼Œå¯ä»¥é€šè¿‡ `@Scheduled` æ³¨è§£è§¦å‘ã€‚

### ç¤ºä¾‹ï¼š
```java
@Component
public class EsbScheduledTask {

    @Autowired
    private EsbCommonService esbCommonService;

    @Scheduled(fixedRate = 60_000) // æ¯åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡
    public void syncCandidateData() {
        CandidatePushDTO dto = new CandidatePushDTO();
        dto.setCandidateId("AUTO_SYNC");
        dto.setName("è‡ªåŠ¨åŒæ­¥å€™é€‰äºº");
        dto.setPosition("ç³»ç»Ÿè‡ªåŠ¨æ¨é€");

        String result = esbCommonService.esbSendInfo(EsbPushServiceEnum.REST_OA_CREATEWORKFLOW, dto);
        // è®°å½•æ—¥å¿—æˆ–å¤„ç†ç»“æœ
    }
}
```


### ğŸ” è¯´æ˜ï¼š
- `@Scheduled`ï¼šå®šæ—¶ä»»åŠ¡æ³¨è§£
- `fixedRate`ï¼šæ¯ 60 ç§’æ‰§è¡Œä¸€æ¬¡
- `esbCommonService`ï¼šæ³¨å…¥æœåŠ¡å±‚å®ä¾‹

### ğŸ“Œ è°ƒç”¨é“¾è·¯ï¼š
```
å®šæ—¶ä»»åŠ¡è§¦å‘ â†’ è°ƒç”¨ Service å±‚ â†’ å‘èµ· ESB è°ƒç”¨
```


---

## âœ… 3. **æ¶ˆæ¯é˜Ÿåˆ—ç›‘å¬å™¨ï¼ˆå¦‚ RabbitMQã€Kafkaã€RocketMQï¼‰**

å¦‚æœç³»ç»Ÿæ˜¯äº‹ä»¶é©±åŠ¨æ¶æ„ï¼Œå¯ä»¥é€šè¿‡ç›‘å¬æ¶ˆæ¯é˜Ÿåˆ—æ¥è§¦å‘ ESB æ¨é€ã€‚

### ç¤ºä¾‹ï¼š
```java
@Component
public class EsbMessageListener {

    @Autowired
    private EsbCommonService esbCommonService;

    @RabbitListener(queues = "candidate.push.queue")
    public void handleCandidatePush(CandidatePushDTO dto) {
        String result = esbCommonService.esbSendInfo(EsbPushServiceEnum.REST_OA_CREATEWORKFLOW, dto);
        // å¤„ç†æ¨é€ç»“æœ
    }
}
```


### ğŸ” è¯´æ˜ï¼š
- `@RabbitListener`ï¼šç›‘å¬ RabbitMQ é˜Ÿåˆ—
- `CandidatePushDTO`ï¼šä»é˜Ÿåˆ—ä¸­æ¶ˆè´¹çš„æ•°æ®
- `esbCommonService`ï¼šè°ƒç”¨æœåŠ¡å±‚è¿›è¡Œ ESB æ¨é€

### ğŸ“Œ è°ƒç”¨é“¾è·¯ï¼š
```
æ¶ˆæ¯åˆ°è¾¾é˜Ÿåˆ— â†’ æ¶ˆè´¹è€…ç›‘å¬åˆ°æ¶ˆæ¯ â†’ è°ƒç”¨ Service å±‚ â†’ å‘èµ· ESB è°ƒç”¨
```


---

## âœ… 4. **å…¶ä»–æœåŠ¡å±‚ç»„ä»¶ï¼ˆService-to-Serviceï¼‰**

æœåŠ¡å±‚ä¹‹é—´ä¹Ÿå¯ä»¥äº’ç›¸è°ƒç”¨ï¼Œä¾‹å¦‚æŸä¸ª `CandidateService` è°ƒç”¨ `EsbCommonService` æ¥æ¨é€æ•°æ®ã€‚

### ç¤ºä¾‹ï¼š
```java
@Service
public class CandidateService {

    @Autowired
    private EsbCommonService esbCommonService;

    public void processAndPushCandidate(Candidate candidate) {
        // 1. å¤„ç†å€™é€‰äººæ•°æ®
        CandidatePushDTO dto = convertToPushDTO(candidate);

        // 2. æ¨é€æ•°æ®åˆ° ESB
        esbCommonService.esbSendInfo(EsbPushServiceEnum.REST_OA_CREATEWORKFLOW, dto);
    }
}
```


### ğŸ” è¯´æ˜ï¼š
- `@Service`ï¼šè¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ª Spring ç®¡ç†çš„ Bean
- `esbCommonService`ï¼šæ³¨å…¥çš„ ESB æœåŠ¡
- `convertToPushDTO()`ï¼šå°†ä¸šåŠ¡æ•°æ®è½¬æ¢ä¸º ESB æ¨é€æ ¼å¼

### ğŸ“Œ è°ƒç”¨é“¾è·¯ï¼š
```
ä¸šåŠ¡é€»è¾‘ â†’ è°ƒç”¨ Service å±‚ â†’ å‘èµ· ESB è°ƒç”¨
```


---

## âœ… 5. **å¤–éƒ¨ç³»ç»Ÿè°ƒç”¨ï¼ˆé€šè¿‡ Feign / OpenFeignï¼‰**

å¦‚æœå½“å‰æœåŠ¡æ˜¯è¢«å…¶ä»–æœåŠ¡è°ƒç”¨çš„â€œä¸­é—´æœåŠ¡â€ï¼Œåˆ™å¯ä»¥é€šè¿‡ Feign æ¥å£æ¥æ”¶è¯·æ±‚ï¼Œå†è°ƒç”¨æœ¬åœ°æœåŠ¡å±‚ã€‚

### ç¤ºä¾‹ï¼š
```java
@FeignClient(name = "candidate-service")
public interface CandidateClient {
    @PostMapping("/push")
    ResponseResult<String> pushCandidate(@RequestBody CandidatePushDTO dto);
}
```
```java
@Service
public class EsbDelegateService {

    @Autowired
    private CandidateClient candidateClient;

    public void handleExternalPush(CandidatePushDTO dto) {
        // è°ƒç”¨å¤–éƒ¨æœåŠ¡
        ResponseResult<String> result = candidateClient.pushCandidate(dto);

        // å¦‚æœéœ€è¦ï¼Œå†è°ƒç”¨æœ¬åœ° ESB æ¨é€
        esbCommonService.esbSendInfo(EsbPushServiceEnum.REST_OA_CREATEWORKFLOW, dto);
    }
}
```


### ğŸ” è¯´æ˜ï¼š
- `CandidateClient`ï¼šè¿œç¨‹è°ƒç”¨å…¶ä»–æœåŠ¡
- `EsbDelegateService`ï¼šåè°ƒæœ¬åœ° ESB æ¨é€é€»è¾‘

---

## âœ… 6. **å•å…ƒæµ‹è¯•æˆ– API æµ‹è¯•å·¥å…·ï¼ˆå¦‚ Postmanï¼‰**

åœ¨å¼€å‘é˜¶æ®µï¼Œå¯ä»¥é€šè¿‡å•å…ƒæµ‹è¯•æˆ– Postman ç­‰å·¥å…·ç›´æ¥è°ƒç”¨ Controller å±‚æ¥å£ï¼Œä»è€Œé—´æ¥è°ƒç”¨æœåŠ¡å±‚ã€‚

### ç¤ºä¾‹æµ‹è¯•ç±»ï¼š
```java
@SpringBootTest
public class EsbIntegrationTest {

    @Autowired
    private EsbCommonService esbCommonService;

    @Test
    void testEsbPush() {
        CandidatePushDTO dto = new CandidatePushDTO();
        dto.setCandidateId("TEST-001");
        dto.setName("æµ‹è¯•å€™é€‰äºº");
        dto.setPosition("æµ‹è¯•å²—ä½");

        String result = esbCommonService.esbSendInfo(EsbPushServiceEnum.REST_OA_CREATEWORKFLOW, dto);
        assertNotNull(result);
    }
}
```


---

## ğŸ“Œ æ€»ç»“ï¼šæœåŠ¡å±‚çš„è°ƒç”¨æ¥æº

| è°ƒç”¨æ¥æº | ç¤ºä¾‹ | ç‰¹ç‚¹ |
|----------|------|------|
| **Controller å±‚** | `@RestController` | æœ€å¸¸è§ï¼Œç”¨äºæ¥æ”¶å¤–éƒ¨è¯·æ±‚ |
| **å®šæ—¶ä»»åŠ¡** | `@Scheduled` | å®šæ—¶è§¦å‘ ESB æ¨é€ |
| **æ¶ˆæ¯é˜Ÿåˆ—ç›‘å¬å™¨** | `@RabbitListener` | äº‹ä»¶é©±åŠ¨ï¼Œå¼‚æ­¥å¤„ç† |
| **å…¶ä»–æœåŠ¡å±‚ç»„ä»¶** | `@Service` | æœåŠ¡å†…éƒ¨è°ƒç”¨ |
| **å¤–éƒ¨æœåŠ¡è°ƒç”¨** | Feign å®¢æˆ·ç«¯ | å¾®æœåŠ¡é—´é€šä¿¡ |
| **å•å…ƒæµ‹è¯•** | `@SpringBootTest` | å¼€å‘é˜¶æ®µæµ‹è¯•ç”¨ |

---

## ğŸ’¡ ä¸¾ä¸ªå®é™…ä¾‹å­ï¼šæ‹›è˜ç³»ç»Ÿä¸­ ESB æ¨é€å€™é€‰äººæµç¨‹

```
1. å€™é€‰äººæ•°æ®å…¥åº“
2. CandidateController æ¥æ”¶åˆ° POST è¯·æ±‚
3. è°ƒç”¨ CandidateService å¤„ç†ä¸šåŠ¡é€»è¾‘
4. CandidateService è°ƒç”¨ EsbCommonService æ¨é€æ•°æ®
5. EsbCommonService æ„å»ºè¯·æ±‚å¹¶è°ƒç”¨ Feign å®¢æˆ·ç«¯
6. Feign å®¢æˆ·ç«¯å‘é€ HTTP è¯·æ±‚åˆ° ESB
7. ESB è½¬å‘è¯·æ±‚åˆ° OA ç³»ç»Ÿ
8. OA ç³»ç»Ÿå¤„ç†åè¿”å›ç»“æœ
9. EsbCommonService æå– resData è¿”å›ç»™ Controller
10. Controller è¿”å›ç»Ÿä¸€æ ¼å¼ç»™å‰ç«¯
```


---

## âœ… å›ç­”æ‚¨çš„é—®é¢˜ï¼š

> **â€œé‚£ä¹ˆæ˜¯è°æ¥è°ƒç”¨æœåŠ¡å±‚çš„å‘èµ·çš„ï¼Ÿâ€**

**ç­”æ¡ˆï¼š**
æœåŠ¡å±‚ï¼ˆ`EsbCommonService`ï¼‰å¯ä»¥è¢«ä»¥ä¸‹ä»»æ„ä¸€ç§æ–¹å¼è°ƒç”¨ï¼š

| è°ƒç”¨è€… | ç¤ºä¾‹ | åœºæ™¯ |
|--------|------|------|
| Controller | `CandidateController` | æ¥æ”¶å¤–éƒ¨ HTTP è¯·æ±‚ |
| å®šæ—¶ä»»åŠ¡ | `@Scheduled` | å®šæ—¶åŒæ­¥æ•°æ® |
| æ¶ˆæ¯ç›‘å¬å™¨ | `@RabbitListener` | å¼‚æ­¥äº‹ä»¶å¤„ç† |
| å…¶ä»– Service | `CandidateService` | æœåŠ¡é—´è°ƒç”¨ |
| Feign å®¢æˆ·ç«¯ | `CandidateClient` | å¾®æœåŠ¡è°ƒç”¨ |
| å•å…ƒæµ‹è¯• | `@SpringBootTest` | å¼€å‘é˜¶æ®µæµ‹è¯• |

---

## ğŸ§© æ‹“æ‰‘å›¾ï¼šæœåŠ¡å±‚è°ƒç”¨å…³ç³»

```
[å¤–éƒ¨ HTTP è¯·æ±‚]
        â†“
[Controller]
        â†“
[Service A]
        â†“
[Service B] â†’ [EsbCommonService]
        â†“
[Feign Client]
        â†“
[ESB ç³»ç»Ÿ]
        â†“
[ç›®æ ‡ç³»ç»Ÿï¼ˆå¦‚ OAã€HRMSï¼‰]
```


---

## ğŸ’¡ å»ºè®®

å¦‚æœæ‚¨æ­£åœ¨å¼€å‘æ–°åŠŸèƒ½ï¼Œå»ºè®®ï¼š
- **Controller å±‚**ï¼šè´Ÿè´£æ¥æ”¶è¯·æ±‚å’Œè¿”å›å“åº”
- **Service å±‚**ï¼šè´Ÿè´£ä¸šåŠ¡é€»è¾‘å’Œ ESB æ¨é€
- **DTO ç»“æ„**ï¼šä¿æŒç»Ÿä¸€ï¼Œä¾¿äºæ‰©å±•
- **å¼‚å¸¸å¤„ç†**ï¼šç»Ÿä¸€æ•è·å¹¶è¿”å›æ ‡å‡†é”™è¯¯ç 

æ˜¯å¦éœ€è¦æˆ‘ç°åœ¨ä¸ºæ‚¨ç”Ÿæˆä¸€ä¸ªå®Œæ•´çš„ Controller ç¤ºä¾‹ï¼Ÿæˆ–è€…æ‚¨å¸Œæœ›äº†è§£å¦‚ä½•æ·»åŠ æ–°çš„ ESB æ¥å£ï¼Ÿ